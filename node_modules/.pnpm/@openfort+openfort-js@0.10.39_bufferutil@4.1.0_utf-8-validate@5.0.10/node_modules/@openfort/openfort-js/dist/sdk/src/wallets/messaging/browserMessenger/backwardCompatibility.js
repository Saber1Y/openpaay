import{isObject as e,isAck1Message as a,isCallMessage as r,isReplyMessage as n}from"./guards.js";import l from"./namespace.js";import t from"./PenpalBugError.js";const p="deprecated-penpal";var i,o;!function(e){e.Call="call",e.Reply="reply",e.Syn="syn",e.SynAck="synAck",e.Ack="ack"}(i||(i={})),function(e){e.Fulfilled="fulfilled",e.Rejected="rejected"}(o||(o={}));const u=a=>e(a)&&"penpal"in a,d=e=>e.split("."),s=e=>e.join("."),c=e=>new t(`Unexpected message to translate: ${JSON.stringify(e)}`),m=e=>{if(e.penpal===i.Syn)return{namespace:l,channel:void 0,type:"SYN",participantId:p};if(e.penpal===i.SynAck)return{namespace:l,channel:void 0,type:"ACK1",methodPaths:e.methodNames.map(d)};if(e.penpal===i.Ack)return{namespace:l,channel:void 0,type:"ACK2"};if(e.penpal===i.Call)return{namespace:l,channel:void 0,type:"CALL",id:e.id,methodPath:d(e.methodName),args:e.args};if(e.penpal===i.Reply)return e.resolution===o.Fulfilled?{namespace:l,channel:void 0,type:"REPLY",callId:e.id,value:e.returnValue}:{namespace:l,channel:void 0,type:"REPLY",callId:e.id,isError:!0,...e.returnValueIsError?{value:e.returnValue,isSerializedErrorInstance:!0}:{value:e.returnValue}};throw c(e)},h=e=>{if(a(e))return{penpal:i.SynAck,methodNames:e.methodPaths.map(s)};if(r(e))return{penpal:i.Call,id:e.id,methodName:s(e.methodPath),args:e.args};if(n(e))return e.isError?{penpal:i.Reply,id:e.callId,resolution:o.Rejected,...e.isSerializedErrorInstance?{returnValue:e.value,returnValueIsError:!0}:{returnValue:e.value}}:{penpal:i.Reply,id:e.callId,resolution:o.Fulfilled,returnValue:e.value};throw c(e)};export{p as DEPRECATED_PENPAL_PARTICIPANT_ID,h as downgradeMessage,u as isDeprecatedMessage,m as upgradeMessage};
