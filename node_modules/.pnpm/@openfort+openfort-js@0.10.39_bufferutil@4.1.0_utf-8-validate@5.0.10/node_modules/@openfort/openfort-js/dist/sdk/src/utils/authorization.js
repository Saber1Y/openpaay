import{keccak256 as t}from"@ethersproject/keccak256";function r(r){const{address:n,chainId:e,nonce:i}=r,o=function(t,r,n){const e=(t,r)=>{if(t<56)return(r+t).toString(16).padStart(2,"0");const n=t.toString(16),e=Math.ceil(n.length/2);return(r+55+e).toString(16).padStart(2,"0")+n.padStart(2*e,"0")},i=[t,r,n].map(t=>{if("number"==typeof t){if(0===t)return"80";t=`0x${t.toString(16)}`}let r=t.startsWith("0x")?t.slice(2):t;return r.length%2!=0&&(r=`0${r}`),0===r.length?"80":2===r.length&&parseInt(r,16)<128?r:e(r.length/2,128)+r}).join(""),o=i.length/2;return`0x${e(o,192)}${i}`}(e,n,i),s=`0x05${o.slice(2)}`;return t(s)}async function n(t){const{authorization:n,signer:e}=t,i=r(n),o=await e.sign(i,!1,!1),s=o.startsWith("0x")?o.slice(2):o,a=`0x${s.slice(0,64)}`,c=`0x${s.slice(64,128)}`,d=s.slice(128,130),h=parseInt(d,16);let u;u=27===h||0===h||"1b"===d?0:28===h||1===h||"1c"===d?1:h>=35?h%2==0?1:0:h%2;const l=0===u?27:28;return{...n,r:a,s:c,v:l,yParity:u}}function e(t){const{r:r,s:n,yParity:e}=t,i=r.startsWith("0x")?r.slice(2):r,o=n.startsWith("0x")?n.slice(2):n;return`0x${i.padStart(64,"0")}${o.padStart(64,"0")}${e.toString(16).padStart(2,"0")}`}async function i(t){const{signer:r,contractAddress:e,chainId:i,nonce:o}=t;if(!e)throw new Error("contractAddress is required");if(void 0===i)throw new Error("chainId is required. Please provide it or fetch it from your RPC provider using eth_chainId");if(void 0===o)throw new Error("nonce is required. Please provide it or fetch it from your RPC provider using eth_getTransactionCount");return n({authorization:{address:e,chainId:i,nonce:o},signer:r})}export{i as prepareAndSignAuthorization,e as serializeSignedAuthorization,n as signAuthorization};
