"use strict";var e=require("./guards.js"),a=require("./namespace.js"),r=require("./PenpalBugError.js");const l="deprecated-penpal";var n,t;!function(e){e.Call="call",e.Reply="reply",e.Syn="syn",e.SynAck="synAck",e.Ack="ack"}(n||(n={})),function(e){e.Fulfilled="fulfilled",e.Rejected="rejected"}(t||(t={}));const s=e=>e.split("."),i=e=>e.join("."),p=e=>new r(`Unexpected message to translate: ${JSON.stringify(e)}`);exports.DEPRECATED_PENPAL_PARTICIPANT_ID=l,exports.downgradeMessage=a=>{if(e.isAck1Message(a))return{penpal:n.SynAck,methodNames:a.methodPaths.map(i)};if(e.isCallMessage(a))return{penpal:n.Call,id:a.id,methodName:i(a.methodPath),args:a.args};if(e.isReplyMessage(a))return a.isError?{penpal:n.Reply,id:a.callId,resolution:t.Rejected,...a.isSerializedErrorInstance?{returnValue:a.value,returnValueIsError:!0}:{returnValue:a.value}}:{penpal:n.Reply,id:a.callId,resolution:t.Fulfilled,returnValue:a.value};throw p(a)},exports.isDeprecatedMessage=a=>e.isObject(a)&&"penpal"in a,exports.upgradeMessage=e=>{if(e.penpal===n.Syn)return{namespace:a,channel:void 0,type:"SYN",participantId:l};if(e.penpal===n.SynAck)return{namespace:a,channel:void 0,type:"ACK1",methodPaths:e.methodNames.map(s)};if(e.penpal===n.Ack)return{namespace:a,channel:void 0,type:"ACK2"};if(e.penpal===n.Call)return{namespace:a,channel:void 0,type:"CALL",id:e.id,methodPath:s(e.methodName),args:e.args};if(e.penpal===n.Reply)return e.resolution===t.Fulfilled?{namespace:a,channel:void 0,type:"REPLY",callId:e.id,value:e.returnValue}:{namespace:a,channel:void 0,type:"REPLY",callId:e.id,isError:!0,...e.returnValueIsError?{value:e.returnValue,isSerializedErrorInstance:!0}:{value:e.returnValue}};throw p(e)};
