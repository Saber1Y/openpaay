"use strict";var t=require("@ethersproject/keccak256");function r(r){const{address:e,chainId:n,nonce:i}=r,o=function(t,r,e){const n=(t,r)=>{if(t<56)return(r+t).toString(16).padStart(2,"0");const e=t.toString(16),n=Math.ceil(e.length/2);return(r+55+n).toString(16).padStart(2,"0")+e.padStart(2*n,"0")},i=[t,r,e].map(t=>{if("number"==typeof t){if(0===t)return"80";t=`0x${t.toString(16)}`}let r=t.startsWith("0x")?t.slice(2):t;return r.length%2!=0&&(r=`0${r}`),0===r.length?"80":2===r.length&&parseInt(r,16)<128?r:n(r.length/2,128)+r}).join(""),o=i.length/2;return`0x${n(o,192)}${i}`}(n,e,i),s=`0x05${o.slice(2)}`;return t.keccak256(s)}async function e(t){const{authorization:e,signer:n}=t,i=r(e),o=await n.sign(i,!1,!1),s=o.startsWith("0x")?o.slice(2):o,a=`0x${s.slice(0,64)}`,c=`0x${s.slice(64,128)}`,d=s.slice(128,130),u=parseInt(d,16);let h;h=27===u||0===u||"1b"===d?0:28===u||1===u||"1c"===d?1:u>=35?u%2==0?1:0:u%2;const g=0===h?27:28;return{...e,r:a,s:c,v:g,yParity:h}}exports.prepareAndSignAuthorization=async function(t){const{signer:r,contractAddress:n,chainId:i,nonce:o}=t;if(!n)throw new Error("contractAddress is required");if(void 0===i)throw new Error("chainId is required. Please provide it or fetch it from your RPC provider using eth_chainId");if(void 0===o)throw new Error("nonce is required. Please provide it or fetch it from your RPC provider using eth_getTransactionCount");return e({authorization:{address:n,chainId:i,nonce:o},signer:r})},exports.serializeSignedAuthorization=function(t){const{r:r,s:e,yParity:n}=t,i=r.startsWith("0x")?r.slice(2):r,o=e.startsWith("0x")?e.slice(2):e;return`0x${i.padStart(64,"0")}${o.padStart(64,"0")}${n.toString(16).padStart(2,"0")}`},exports.signAuthorization=e;
